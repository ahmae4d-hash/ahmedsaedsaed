<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <link
      rel="manifest"
      href="data:application/manifest+json;base64,ewogICJuYW1lIjogIm1vbnpvbWF0IGFsYmFzaGF3YXQiLAogICJzaG9ydF9uYW1lIjogImFsYmFzaGF3YXQiLAogICJzdGFydF91cmwiOiAiLiIsCiAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSIsCiAgImJhY2tncm91bmRfY29sb3IiOiAiIzFhMjM3ZSIsCiAgInRoZW1lX2NvbG9yIjogIiMxYTIzN2UiLAogICJpY29ucyI6IFsKICAgIHsKICAgICAgInNyYyI6ICJodHRwczovL2kuaWJiLmNvL1ZXTVhzTHF6L1doYXRzLUFwcC1JbWFnZS0yMDI2LTAxLTIzLWF0LTUtNDEtMTktUE0uanBnIiwKICAgICAgInNpemVzIjogIjUxMng1MTIiLAogICAgICAidHlwZSI6ICJpbWFnZS9qcGVnIgogICAgfQogIF0KfQ=="
    />
    <link
      rel="icon"
      type="image/jpeg"
      href="https://i.ibb.co/VWMxsLqz/Whats-App-Image-2026-01-23-at-5-41-19-PM.jpg"
    />
    <meta
      property="og:image"
      content="https://i.ibb.co/VWMxsLqz/Whats-App-Image-2026-01-23-at-5-41-19-PM.jpg"
    />
    <meta property="og:image:type" content="image/jpeg" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta
      name="twitter:image"
      content="https://i.ibb.co/VWMxsLqz/Whats-App-Image-2026-01-23-at-5-41-19-PM.jpg"
    />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ù…Ù†Ø¸ÙˆÙ…Ø© Ø§Ù„Ø¨Ø´ÙˆØ§Øª   </title>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <style>
      :root {
        --bg-body: #e0e4e8;
        --border-color: #000000;
        --row-hover: #fff9c4;
        --accent: #ffd700;
        --primary: #1a237e;
      }
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        font-family: "Segoe UI", Arial, sans-serif;
      }
      body {
        background: var(--bg-body);
        padding: 10px;
        scroll-behavior: smooth;
      }

      /* --- ØµÙØ­Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ§Ù„Ø³Ø§Ø¹Ø© --- */
      #login-page {
        position: fixed;
        inset: 0;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 9999;
        background: linear-gradient(-45deg, #0d47a1, #1e293b);
      }
      .analog-clock {
        width: 220px;
        height: 220px;
        background: white;
        border: 10px solid var(--accent);
        border-radius: 50%;
        position: relative;
        margin-bottom: 30px;
        box-shadow: 0 0 40px rgba(0, 0, 0, 0.6);
      }
      .clock-num {
        position: absolute;
        font-weight: bold;
        font-size: 20px;
        color: #000;
      }
      .n12 {
        top: 10px;
        left: 50%;
        transform: translateX(-50%);
      }
      .n3 {
        right: 10px;
        top: 50%;
        transform: translateY(-50%);
      }
      .n6 {
        bottom: 10px;
        left: 50%;
        transform: translateX(-50%);
      }
      .n9 {
        left: 10px;
        top: 50%;
        transform: translateY(-50%);
      }
      .hand {
        position: absolute;
        bottom: 50%;
        left: 50%;
        transform-origin: bottom;
        border-radius: 10px;
        z-index: 5;
      }
      .hour {
        width: 7px;
        height: 55px;
        background: #000;
      }
      .min {
        width: 5px;
        height: 80px;
        background: #333;
      }
      .sec {
        width: 2px;
        height: 90px;
        background: #d32f2f;
      }

      /* --- ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙˆØ§Ù„Ø£Ø²Ø±Ø§Ø± --- */
      .container {
        max-width: 1250px;
        margin: auto;
        background: white;
        padding: 25px;
        border-radius: 15px;
        border: 4px solid var(--border-color);
      }
      .sticky-header {
        position: sticky;
        top: 0;
        z-index: 1000;
        background: var(--bg-body);
        padding-bottom: 10px;
      }
      .entry-form {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
        gap: 10px;
        background: #f1f5f9;
        padding: 25px 15px 15px;
        border-radius: 12px;
        border: 3px solid var(--border-color);
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
        border: 3px solid var(--border-color);
      }
      th,
      td {
        border: 2px solid var(--border-color);
        padding: 12px 5px;
        text-align: center;
        font-weight: 900;
        font-size: 18px;
      }
      th {
        background: #d1d5db;
        position: sticky;
        top: 205px;
        z-index: 900;
      }
      tbody tr:hover {
        background-color: var(--row-hover) !important;
      }
      .total-row {
        background: var(--border-color) !important;
        color: var(--accent) !important;
      }

      /* --- Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ (Ù†Ø§ÙØ°Ø© Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª) --- */
      #options-modal {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.7);
        z-index: 10001;
        justify-content: center;
        align-items: center;
      }
      .modal-content {
        background: white;
        padding: 30px;
        border-radius: 15px;
        text-align: center;
        width: 320px;
        border: 4px solid var(--primary);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      }
      .btn-main {
        padding: 12px 20px;
        border-radius: 8px;
        cursor: pointer;
        border: none;
        font-weight: 900;
        color: white;
        margin: 5px;
      }
      .archive-item {
        background: var(--primary);
        color: white;
        padding: 8px 15px;
        border-radius: 8px;
        cursor: pointer;
        margin: 5px;
        display: inline-block;
        font-weight: bold;
        border: 2px solid #000;
      }

      /* --- Ù‚Ø³Ù… Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ø§Ù… Ø§Ù„Ù…ÙˆØ­Ø¯ --- */
      .grand-total-section {
        margin-top: 30px;
        padding: 20px;
        border: 4px solid var(--border-color);
        border-radius: 15px;
        background: #e2e8f0;
      }
      .grand-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: 15px;
        margin-top: 10px;
      }
      .grand-box {
        text-align: center;
      }
      .grand-box label {
        display: block;
        font-size: 14px;
        font-weight: bold;
        margin-bottom: 5px;
        color: #000;
      }
      .grand-box input {
        width: 100%;
        padding: 12px;
        text-align: center;
        font-weight: 900;
        font-size: 20px;
        border: 3px solid var(--border-color);
        border-radius: 10px;
        background: #fff;
        color: #d32f2f; /* Ù„ÙˆÙ† Ù…Ù…ÙŠØ² Ù„Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª Ø§Ù„Ø«Ø§Ø¨ØªØ© */
      }

      @media print {
        .no-print {
          display: none !important;
        }
      }
    </style>
  </head>
  <body onkeydown="handleGlobalEnter(event)">
    <div id="login-page">
      <div class="analog-clock">
        <div class="clock-num n12">12</div>
        <div class="clock-num n3">3</div>
        <div class="clock-num n6">6</div>
        <div class="clock-num n9">9</div>
        <div id="h-hand" class="hand hour"></div>
        <div id="m-hand" class="hand min"></div>
        <div id="s-hand" class="hand sec"></div>
      </div>
      <div
        style="
          background: rgba(255, 255, 255, 0.1);
          padding: 30px;
          border-radius: 20px;
          text-align: center;
          width: 350px;
          backdrop-filter: blur(10px);
        "
      >
        <h2 style="color: white; margin-bottom: 20px">Ø§Ø¯Ø®Ù„ ÙŠØ§ Ø¨Ø§Ø´Ø§</h2>
        <input
          type="password"
          id="passInput"
          placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±"
          style="
            width: 100%;
            padding: 15px;
            border-radius: 10px;
            border: none;
            text-align: center;
            font-size: 20px;
          "
          autofocus
        />
        <button
          onclick="login()"
          class="btn-main"
          style="
            background: var(--accent);
            color: #000;
            width: 100%;
            margin-top: 15px;
          "
        >
          Ø¯Ø®ÙˆÙ„
        </button>
      </div>
    </div>

    <div class="container" id="main-content" style="display: none">
      <div class="sticky-header no-print">
        <section
          style="
            background: #f1f5f9;
            border: 3px solid #000;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 10px;
          "
        >
          <div style="display: flex; gap: 12px">
            <input
              type="text"
              id="saveName"
              placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù Ù„Ù„Ø­ÙØ¸..."
              style="
                flex: 1;
                padding: 10px;
                border: 2px solid #000;
                border-radius: 8px;
                font-weight: bold;
              "
            />
            <button
              class="btn-main"
              style="background: green"
              onclick="saveToArchive()"
            >
              ğŸ’¾ Ø­ÙØ¸
            </button>
            <input
              type="text"
              id="searchBox"
              placeholder="Ø¨Ø­Ø«..."
              oninput="filterArchive()"
              style="
                flex: 1;
                padding: 10px;
                border: 2px solid #000;
                border-radius: 8px;
              "
            />
          </div>
          <div id="archiveList" style="margin-top: 12px"></div>
        </section>

        <div class="entry-form">
          <div style="position: relative">
            <input
              type="number"
              id="f_count"
              oninput="autoCalc(this.value)"
              style="
                width: 100%;
                padding: 12px;
                border: 2px solid #000;
                border-radius: 8px;
                text-align: center;
                font-weight: 900;
              "
            /><label
              style="
                position: absolute;
                top: -12px;
                right: 10px;
                background: #f1f5f9;
                font-size: 17px;
                font-weight: bold;
              "
              >Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ø±ÙƒØ§Øª</label
            >
          </div>
          <div style="position: relative">
            <input
              type="number"
              id="f_a"
              style="
                width: 100%;
                padding: 12px;
                border: 2px solid #000;
                text-align: center;
                font-weight: 900;
              "
            /><label
              style="
                position: absolute;
                top: -12px;
                right: 10px;
                background: #f1f5f9;
                font-size: 17px;
              "
              >Ø£Ù…Ø§Ù†Ø§Øª</label
            >
          </div>
          <div style="position: relative">
            <input
              type="number"
              id="f_s"
              style="
                width: 100%;
                padding: 12px;
                border: 2px solid #000;
                text-align: center;
                font-weight: 900;
              "
            /><label
              style="
                position: absolute;
                top: -12px;
                right: 10px;
                background: #f1f5f9;
                font-size: 17px;
              "
              >Ø·.Ø´Ù‡ÙŠØ¯</label
            >
          </div>
          <div style="position: relative">
            <input
              type="number"
              id="f_p"
              style="
                width: 100%;
                padding: 12px;
                border: 2px solid #000;
                text-align: center;
                font-weight: 900;
              "
            /><label
              style="
                position: absolute;
                top: -12px;
                right: 10px;
                background: #f1f5f9;
                font-size: 17px;
              "
              >Ø·.Ø´Ø±Ø·Ø©</label
            >
          </div>
          <div style="position: relative">
            <input
              type="number"
              id="f_old"
              style="
                width: 100%;
                padding: 12px;
                border: 2px solid #000;
                text-align: center;
                font-weight: 900;
              "
            /><label
              style="
                position: absolute;
                top: -12px;
                right: 10px;
                background: #f1f5f9;
                font-size: 17px;
              "
              >Ù…Ø³Ù†ÙŠÙ†</label
            >
          </div>
          <div style="position: relative">
            <input
              type="number"
              id="f_dis"
              style="
                width: 100%;
                padding: 12px;
                border: 2px solid #000;
                text-align: center;
                font-weight: 900;
              "
            /><label
              style="
                position: absolute;
                top: -12px;
                right: 10px;
                background: #f1f5f9;
                font-size: 17px;
              "
              >Ø¥Ø¹Ø§Ù‚Ø©</label
            >
          </div>
          <div style="position: relative">
            <input
              type="number"
              id="f_m"
              value="35"
              readonly
              style="
                width: 100%;
                padding: 12px;
                border: 2px solid #000;
                background: #ddd;
                text-align: center;
                font-weight: 900;
              "
            /><label
              style="
                position: absolute;
                top: -12px;
                right: 10px;
                background: #f1f5f9;
                font-size: 17px;
              "
              >Ù…ÙŠÙƒÙ†Ø©</label
            >
          </div>
          <button
            onclick="saveToTable()"
            class="btn-main"
            style="background: #059669"
          >
            Ø¥Ø¶Ø§ÙØ© (Enter)
          </button>
        </div>
      </div>

      <table id="mainTable">
        <thead>
          <tr>
            <th style="width: 50px">Ù…</th>
            <th>Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ø±ÙƒØ§Øª</th>
            <th>Ø£Ù…Ø§Ù†Ø§Øª</th>
            <th>Ø·.Ø´Ù‡ÙŠØ¯</th>
            <th>Ø·.Ø´Ø±Ø·Ø©</th>
            <th>Ù…Ø³Ù†ÙŠÙ†</th>
            <th>Ø¥Ø¹Ø§Ù‚Ø©</th>
            <th>Ù…ÙŠÙƒÙ†Ø©</th>
          </tr>
        </thead>
        <tbody id="fixedBody"></tbody>
        <tfoot>
          <tr class="total-row">
            <td colspan="2">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€ÙŠ Ù„Ù„Ù…Ù„Ù Ø§Ù„Ø­Ø§Ù„ÙŠ</td>
            <td id="sum_a">0</td>
            <td id="sum_s">0</td>
            <td id="sum_p">0</td>
            <td id="sum_old">0</td>
            <td id="sum_dis">0</td>
            <td id="sum_m">0</td>
          </tr>
        </tfoot>
      </table>

      <section class="grand-total-section no-print">
        <h2
          style="
            text-align: center;
            color: #000;
            margin-bottom: 10px;
            border-bottom: 2px solid #000;
            padding-bottom: 5px;
          "
        >
          Ø§Ø¬Ù…Ø§Ù„Ù‰ ÙƒØ§ÙØ© Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
        </h2>
        <div class="grand-grid">
          <div class="grand-box">
            <label>Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø£Ù…Ø§Ù†Ø§Øª</label>
            <input type="number" id="grand_sum_a" readonly />
          </div>
          <div class="grand-box">
            <label>Ù…Ø¬Ù…ÙˆØ¹ Ø·.Ø´Ù‡ÙŠØ¯</label>
            <input type="number" id="grand_sum_s" readonly />
          </div>
          <div class="grand-box">
            <label>Ù…Ø¬Ù…ÙˆØ¹ Ø·.Ø´Ø±Ø·Ø©</label>
            <input type="number" id="grand_sum_p" readonly />
          </div>
          <div class="grand-box">
            <label>Ù…Ø¬Ù…ÙˆØ¹ Ù…Ø³Ù†ÙŠÙ†</label>
            <input type="number" id="grand_sum_old" readonly />
          </div>
          <div class="grand-box">
            <label>Ù…Ø¬Ù…ÙˆØ¹ Ø¥Ø¹Ø§Ù‚Ø©</label>
            <input type="number" id="grand_sum_dis" readonly />
          </div>
          <div class="grand-box">
            <label>Ù…Ø¬Ù…ÙˆØ¹ Ù…ÙŠÙƒÙ†Ø©</label>
            <input type="number" id="grand_sum_m" readonly />
          </div>
        </div>
      </section>

      <div class="no-print" style="text-align: center; margin-top: 20px">
        <button
          class="btn-main"
          style="background: #1e293b"
          onclick="window.print()"
        >
          ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©
        </button>
        <button
          class="btn-main"
          style="background: #166534"
          onclick="exportToExcel()"
        >
          ğŸ“Š Ø¥ÙƒØ³ÙŠÙ„
        </button>
        <button
          class="btn-main"
          style="background: #c62828"
          onclick="clearData()"
        >
          ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„Ø¬Ø¯ÙˆÙ„
        </button>
      </div>
    </div>

    <div id="options-modal" class="no-print">
      <div class="modal-content">
        <h3
          id="modalTitle"
          style="margin-bottom: 20px; color: var(--primary)"
        ></h3>
        <button
          class="btn-main"
          style="background: var(--primary); width: 90%"
          id="btnEdit"
        >
          âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„
        </button>
        <button
          class="btn-main"
          style="background: #c62828; width: 90%"
          id="btnDelete"
        >
          ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„Ù…Ù„Ù Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹
        </button>
        <button
          class="btn-main"
          style="background: #757575; width: 90%"
          onclick="closeModal()"
        >
          Ø¥Ù„ØºØ§Ø¡
        </button>
      </div>
    </div>

    <script>
      function updateClock() {
        const now = new Date();
        const s = now.getSeconds() * 6;
        const m = now.getMinutes() * 6;
        const h = (now.getHours() % 12) * 30 + now.getMinutes() / 2;
        document.getElementById("s-hand").style.transform = `rotate(${s}deg)`;
        document.getElementById("m-hand").style.transform = `rotate(${m}deg)`;
        document.getElementById("h-hand").style.transform = `rotate(${h}deg)`;
      }
      setInterval(updateClock, 1000);
      updateClock();

      let rowsData =
        JSON.parse(localStorage.getItem("fin_v9")) ||
        Array.from({ length: 30 }, () => ({
          count: "",
          a: 0,
          s: 0,
          p: 0,
          old: 0,
          dis: 0,
          m: 0,
        }));
      let archive = JSON.parse(localStorage.getItem("fin_arch_v9")) || {};
      let selectedKey = "";

      function login() {
        if (document.getElementById("passInput").value === "123") {
          document.getElementById("login-page").style.display = "none";
          document.getElementById("main-content").style.display = "block";
          draw();
          renderArchive();
        } else alert("Ø®Ø·Ø£!");
      }

      function autoCalc(v) {
        if (!v) {
          ["f_a", "f_s", "f_p", "f_old", "f_dis"].forEach(
            (id) => (document.getElementById(id).value = "")
          );
          return;
        }
        let n = parseFloat(v);
        document.getElementById("f_a").value = n * 100;
        document.getElementById("f_s").value = n * 5;
        document.getElementById("f_p").value = n * 15;
        document.getElementById("f_old").value = n * 5;
        document.getElementById("f_dis").value = n * 5;
      }

      function draw() {
        const body = document.getElementById("fixedBody");
        body.innerHTML = "";
        rowsData.forEach((row, i) => {
          body.innerHTML += `<tr id="row-${i}">
                    <td style="background:#eee">${i + 1}</td>
                    <td contenteditable="true" onblur="update(${i},'count',this.innerText)">${
            row.count
          }</td>
                    <td contenteditable="true" onblur="update(${i},'a',this.innerText)">${
            row.a || ""
          }</td>
                    <td contenteditable="true" onblur="update(${i},'s',this.innerText)">${
            row.s || ""
          }</td>
                    <td contenteditable="true" onblur="update(${i},'p',this.innerText)">${
            row.p || ""
          }</td>
                    <td contenteditable="true" onblur="update(${i},'old',this.innerText)">${
            row.old || ""
          }</td>
                    <td contenteditable="true" onblur="update(${i},'dis',this.innerText)">${
            row.dis || ""
          }</td>
                    <td contenteditable="true" onblur="update(${i},'m',this.innerText)">${
            row.m || ""
          }</td>
                </tr>`;
        });
        calc();
        localStorage.setItem("fin_v9", JSON.stringify(rowsData));
      }

      function update(idx, f, v) {
        rowsData[idx][f] = f === "count" ? v : Number(v);
        draw();
      }

      function saveToTable() {
        const val = document.getElementById("f_count").value;
        if (!val) return;
        let idx = rowsData.findIndex((r) => r.count === "" || r.count === null);
        if (idx === -1) return alert("Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù…Ù…ØªÙ„Ø¦");
        rowsData[idx] = {
          count: val,
          a: Number(document.getElementById("f_a").value),
          s: Number(document.getElementById("f_s").value),
          p: Number(document.getElementById("f_p").value),
          old: Number(document.getElementById("f_old").value),
          dis: Number(document.getElementById("f_dis").value),
          m: 35,
        };
        draw();
        window.scrollTo({
          top: document.getElementById(`row-${idx}`).offsetTop - 250,
          behavior: "smooth",
        });
        document
          .querySelectorAll(".entry-form input:not(#f_m)")
          .forEach((i) => (i.value = ""));
        document.getElementById("f_count").focus();
      }

      function calc() {
        let t = rowsData.reduce(
          (acc, c) => {
            acc.a += Number(c.a || 0);
            acc.s += Number(c.s || 0);
            acc.p += Number(c.p || 0);
            acc.old += Number(c.old || 0);
            acc.dis += Number(c.dis || 0);
            acc.m += Number(c.m || 0);
            return acc;
          },
          { a: 0, s: 0, p: 0, old: 0, dis: 0, m: 0 }
        );
        for (let k in t) document.getElementById("sum_" + k).innerText = t[k];
      }

      function saveToArchive() {
        let n = document.getElementById("saveName").value;
        if (!n) return alert("Ø§Ø¯Ø®Ù„ Ø§Ø³Ù…!");
        archive[n] = JSON.parse(JSON.stringify(rowsData));
        localStorage.setItem("fin_arch_v9", JSON.stringify(archive));
        alert("ØªÙ… Ø§Ù„Ø­ÙØ¸ ÙˆØªØµÙÙŠØ± Ø§Ù„Ø¬Ø¯ÙˆÙ„");
        clearData();
        renderArchive();
        document.getElementById("saveName").value = "";
      }

      function renderArchive(f = "") {
        const list = document.getElementById("archiveList");
        list.innerHTML = "";
        Object.keys(archive).forEach((k) => {
          if (k.includes(f)) {
            let d = document.createElement("div");
            d.className = "archive-item";
            d.innerText = "ğŸ“ " + k;
            d.onclick = () => {
              selectedKey = k;
              document.getElementById("modalTitle").innerText = k;
              document.getElementById("options-modal").style.display = "flex";
            };
            list.appendChild(d);
          }
        });
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ø§Ù… ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ÙÙˆØ±ÙŠØ§Ù‹
        calculateGrandTotal();
      }

      // Ø§Ù„ÙˆØ¸ÙŠÙØ© Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„Ø© Ø¹Ù† Ø¬Ù…Ø¹ ÙƒÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª ÙÙŠ Ø§Ù„Ø£Ø±Ø´ÙŠÙ ÙˆÙˆØ¶Ø¹ Ø£Ø±Ù‚Ø§Ù… Ø«Ø§Ø¨ØªØ©
      function calculateGrandTotal() {
        let grand = { a: 0, s: 0, p: 0, old: 0, dis: 0, m: 0 };
        Object.values(archive).forEach((fileRows) => {
          fileRows.forEach((row) => {
            grand.a += Number(row.a || 0);
            grand.s += Number(row.s || 0);
            grand.p += Number(row.p || 0);
            grand.old += Number(row.old || 0);
            grand.dis += Number(row.dis || 0);
            grand.m += Number(row.m || 0);
          });
        });
        // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø®Ø§Ù†Ø§Øª (ÙƒÙ„Ù‡Ø§ Readonly)
        document.getElementById("grand_sum_a").value = grand.a;
        document.getElementById("grand_sum_s").value = grand.s;
        document.getElementById("grand_sum_p").value = grand.p;
        document.getElementById("grand_sum_old").value = grand.old;
        document.getElementById("grand_sum_dis").value = grand.dis;
        document.getElementById("grand_sum_m").value = grand.m;
      }

      document.getElementById("btnEdit").onclick = () => {
        rowsData = JSON.parse(JSON.stringify(archive[selectedKey]));
        draw();
        closeModal();
        window.scrollTo(0, 0);
      };
      document.getElementById("btnDelete").onclick = () => {
        if (confirm("Ø­Ø°Ù Ø§Ù„Ù…Ù„Ù Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ")) {
          delete archive[selectedKey];
          localStorage.setItem("fin_arch_v9", JSON.stringify(archive));
          renderArchive();
          closeModal();
        }
      };

      function closeModal() {
        document.getElementById("options-modal").style.display = "none";
      }
      function filterArchive() {
        renderArchive(document.getElementById("searchBox").value);
      }
      function clearData() {
        rowsData = Array.from({ length: 30 }, () => ({
          count: "",
          a: 0,
          s: 0,
          p: 0,
          old: 0,
          dis: 0,
          m: 0,
        }));
        draw();
      }
      function handleGlobalEnter(e) {
        if (e.key === "Enter") {
          if (document.getElementById("login-page").style.display !== "none")
            login();
          else saveToTable();
        }
      }
      function exportToExcel() {
        const ws = XLSX.utils.json_to_sheet(rowsData);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "Ø§Ù„Ù…Ø§Ù„ÙŠØ§Øª");
        XLSX.writeFile(wb, "Report.xlsx");
      }
      // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø¯Ù…Ø© Ù„Ù„Ø¹Ù…Ù„ Ø¨Ø¯ÙˆÙ† Ø¥Ù†ØªØ±Ù†Øª
      if ("serviceWorker" in navigator) {
        window.addEventListener("load", () => {
          const swCode = `
      const CACHE_NAME = 'basha-v1';
      const assets = [ './', './index.html' ]; // ØªØ£ÙƒØ¯ Ø£Ù† Ø§Ø³Ù… Ù…Ù„ÙÙƒ index.html

      self.addEventListener('install', e => {
        e.waitUntil(caches.open(CACHE_NAME).then(cache => cache.addAll(assets)));
      });

      self.addEventListener('fetch', e => {
        e.respondWith(caches.match(e.request).then(res => res || fetch(e.request)));
      });
    `;
          const blob = new Blob([swCode], { type: "application/javascript" });
          const swUrl = URL.createObjectURL(blob);
          navigator.serviceWorker.register(swUrl);
        });
      }
    </script>
  </body>
</html>
